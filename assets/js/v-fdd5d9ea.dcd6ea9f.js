"use strict";(self.webpackChunkhydro_dev_github_io=self.webpackChunkhydro_dev_github_io||[]).push([[2689],{2405:(s,n,a)=>{a.r(n),a.d(n,{data:()=>l});const l=JSON.parse('{"key":"v-fdd5d9ea","path":"/docs/install/compiler.html","title":"编译器","lang":"en-US","frontmatter":{"description":"从 2022/8/12 开始，Hydro 为了避免宿主机环境变化对于评测的影响，对于 此后新安装的实例 默认使用 nix () 管理环境。 如果你是在这之前安装的 Hydro，请使用 apt 安装编译器后使用 pm2 restart hydro-sandbox 重启沙箱，并忽略本章节。 以下是 nix 的简要操作说明： 使用 nix-env -iA n...","head":[["meta",{"property":"og:url","content":"https://hydro.js.org/docs/install/compiler.html"}],["meta",{"property":"og:site_name","content":"Hydro"}],["meta",{"property":"og:title","content":"编译器"}],["meta",{"property":"og:description","content":"从 2022/8/12 开始，Hydro 为了避免宿主机环境变化对于评测的影响，对于 此后新安装的实例 默认使用 nix () 管理环境。 如果你是在这之前安装的 Hydro，请使用 apt 安装编译器后使用 pm2 restart hydro-sandbox 重启沙箱，并忽略本章节。 以下是 nix 的简要操作说明： 使用 nix-env -iA n..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-02-26T07:44:01.000Z"}],["meta",{"property":"article:modified_time","content":"2023-02-26T07:44:01.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"编译器\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-02-26T07:44:01.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"进阶","slug":"进阶","link":"#进阶","children":[]}],"git":{"createdTime":1660293799000,"updatedTime":1677397441000,"contributors":[{"name":"undefined","email":"i@undefined.moe","commits":3}]},"readingTime":{"minutes":1.98,"words":593},"filePathRelative":"docs/install/compiler.md","localizedDate":"August 12, 2022","autoDesc":true,"excerpt":""}')},3186:(s,n,a)=>{a.r(n),a.d(n,{default:()=>E});var l=a(6252);const p=(0,l.uE)('<h1 id="编译器" tabindex="-1"><a class="header-anchor" href="#编译器"><span>编译器</span></a></h1><p>从 2022/8/12 开始，Hydro 为了避免宿主机环境变化对于评测的影响，对于 <strong>此后新安装的实例</strong> 默认使用 <a href="">nix</a> 管理环境。<br> 如果你是在这之前安装的 Hydro，请使用 apt 安装编译器后使用 <code>pm2 restart hydro-sandbox</code> 重启沙箱，并忽略本章节。</p><p>以下是 nix 的简要操作说明：</p><p>使用 <code>nix-env -iA nixpkgs.编译器名</code> 安装新编译器，后重启沙箱 <code>pm2 restart hydro-sandbox</code> 生效。</p>',4),o={href:"https://search.nixos.org/packages",target:"_blank",rel:"noopener noreferrer"},e=(0,l._)("br",null,null,-1),r=(0,l.uE)('<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.busybox</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.bash</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.diffutils</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.unzip</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 基础组件，已预装，不建议删除</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.gcc</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.fpc</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># C/C++ 和 Pascal，已预装，不建议删除</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.ghc</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Haskell </span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.rustc</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Rust</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.python2</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Python2</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.pythonPackages.numpy</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Python2 Numpy 库</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.python3Minimal</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.python3Packages.numpy</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.php</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># PHP</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.go</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Golang</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.nodejs</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># NodeJS</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.openjdk_headless</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Java</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.ruby</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Ruby</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.mono</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># C#</span></span>\n<span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.julia_17-bin</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># Julia</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 <code>nix-env -q</code> 查看已安装的列表，后使用 <code>nix-env -e 编译器名</code> 即可删除对应的编译器。<br> 请注意不要误删 Hydro 基础组件，且操作完成后需要重启沙箱 <code>pm2 restart hydro-sandbox</code> 生效。</p><h2 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h2><p>如果你需要更加复杂的编译环境配置，我们建议使用编写单独的 nix 文件。</p><div class="language-nix line-numbers-mode" data-ext="nix" data-title="nix"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">system</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">?</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">builtins.</span><span style="color:#D8DEE9;">currentSystem</span><span style="color:#81A1C1;">,</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">pkgs</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">?</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">import</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">&lt;nixpkgs&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">system</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">system</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span></span>\n<span class="line"><span style="color:#ECEFF4;">}:</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D8DEE9;">pkgs</span><span style="color:#81A1C1;">.</span><span style="color:#D8DEE9;">buildEnv</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#8FBCBB;">name</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hydrojudge-rootfs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#8FBCBB;">paths</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">with</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">pkgs</span><span style="color:#D8DEE9FF;">; </span><span style="color:#ECEFF4;">[</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">coreutils</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">bash</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">diffutils</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">nix</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">zip</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">unzip</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">gcc</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#616E88;"># 上方包是评测所需要的，请勿删除，</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#616E88;"># 在下方列出你所需要的包，查找方式同上文：</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">fpc</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">python3</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">rustc</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#8FBCBB;">ignoreCollisions</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#8FBCBB;">pathsToLink</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#616E88;"># 导出一些基本信息和部分编译器所需的 /etc/passwd</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#8FBCBB;">postBuild</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;&#39;</span></span>\n<span class="line"><span style="color:#A3BE8C;">    mkdir $out/buildInfo</span></span>\n<span class="line"><span style="color:#A3BE8C;">    echo &#39;root:x:0:0:root:/root:/bin/bash&#39; &gt;$out/etc/passwd</span></span>\n<span class="line"><span style="color:#A3BE8C;">    date &gt;$out/buildInfo/timestamp</span></span>\n<span class="line"><span style="color:#A3BE8C;">  </span><span style="color:#ECEFF4;">&#39;&#39;</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复制以上文件，保存为 <code>default.nix</code> ，使用 <code>nix-build</code> 进行构建。<br> 构建后会产生一个 <code>result</code> 文件夹，记住该文件夹所在的路径。<br> 打开 <code>~/.hydro/mount.yaml</code> 将其中 <code>/root/.nix-profile</code> 替换为编译出的 <code>result</code> 文件夹（切换到新的环境）<br> 之后保存并重启沙箱。</p><p>后续若需更改环境配置，仅需要修改 <code>default.nix</code> 文件之后 <code>nix-build</code> 重新构建，再重启沙箱即可生效。<br> 构建过程中的缓存文件可以使用 <code>nix-collect-garbage</code> 进行清理。</p>',7),t={href:"https://nixos.org/guides/nix-language.html",target:"_blank",rel:"noopener noreferrer"},c={href:"https://nixos.org/manual/nix/stable/language/index.html",target:"_blank",rel:"noopener noreferrer"},i={},E=(0,a(3744).Z)(i,[["render",function(s,n){const a=(0,l.up)("ExternalLinkIcon");return(0,l.wg)(),(0,l.iD)("div",null,[p,(0,l._)("p",null,[(0,l.Uk)("可以在 "),(0,l._)("a",o,[(0,l.Uk)("Nixos Search"),(0,l.Wm)(a)]),(0,l.Uk)(" 中搜索你需要的编译器。"),e,(0,l.Uk)(" 以下是常用编译器的示例：")]),r,(0,l._)("p",null,[(0,l.Uk)("更详细的 nix 语言介绍，请参照 "),(0,l._)("a",t,[(0,l.Uk)("Nix Guide"),(0,l.Wm)(a)]),(0,l.Uk)(" 和 "),(0,l._)("a",c,[(0,l.Uk)("Nix Manual"),(0,l.Wm)(a)]),(0,l.Uk)("。")])])}]])},3744:(s,n)=>{n.Z=(s,n)=>{const a=s.__vccOpts||s;for(const[s,l]of n)a[s]=l;return a}}}]);