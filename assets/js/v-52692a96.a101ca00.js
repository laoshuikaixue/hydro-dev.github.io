"use strict";(self.webpackChunkhydro_dev_github_io=self.webpackChunkhydro_dev_github_io||[]).push([[4374],{9690:(s,n,e)=>{e.r(n),e.d(n,{data:()=>a});const a=JSON.parse('{"key":"v-52692a96","path":"/plugins/sonic.html","title":"Sonic","lang":"en-US","frontmatter":{"description":"安装 安装 sonic-server (https://github.com/valeriansaliou/sonic) 使用 root 用户执行如下命令： 安装 sonic 插件 使用 root 用户执行如下命令： 启动 在 /root/.sonic/config.cfg（没有的自行建立，也可以换成其他的你喜欢的路径）按照以下配置示例写入配置。 配置...","head":[["meta",{"property":"og:url","content":"https://hydro.js.org/plugins/sonic.html"}],["meta",{"property":"og:site_name","content":"Hydro"}],["meta",{"property":"og:title","content":"Sonic"}],["meta",{"property":"og:description","content":"安装 安装 sonic-server (https://github.com/valeriansaliou/sonic) 使用 root 用户执行如下命令： 安装 sonic 插件 使用 root 用户执行如下命令： 启动 在 /root/.sonic/config.cfg（没有的自行建立，也可以换成其他的你喜欢的路径）按照以下配置示例写入配置。 配置..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-02-25T05:29:05.000Z"}],["meta",{"property":"article:modified_time","content":"2023-02-25T05:29:05.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Sonic\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-02-25T05:29:05.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[{"level":3,"title":"安装 sonic-server","slug":"安装-sonic-server","link":"#安装-sonic-server","children":[]},{"level":3,"title":"安装 sonic 插件","slug":"安装-sonic-插件","link":"#安装-sonic-插件","children":[]}]},{"level":2,"title":"启动","slug":"启动","link":"#启动","children":[]},{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[{"level":3,"title":"后端地址配置","slug":"后端地址配置","link":"#后端地址配置","children":[]},{"level":3,"title":"重启 HydroOJ","slug":"重启-hydrooj","link":"#重启-hydrooj","children":[]},{"level":3,"title":"重建题目索引","slug":"重建题目索引","link":"#重建题目索引","children":[]}]},{"level":2,"title":"FAQ","slug":"faq","link":"#faq","children":[{"level":3,"title":"安装后题目搜索不正常","slug":"安装后题目搜索不正常","link":"#安装后题目搜索不正常","children":[]}]}],"git":{"createdTime":1621263423000,"updatedTime":1677302945000,"contributors":[{"name":"panda","email":"panda_dtdyy@outlook.com","commits":2},{"name":"undefined","email":"i@undefined.moe","commits":2},{"name":"立言","email":"liyanqwq@duianit.cn","commits":2}]},"readingTime":{"minutes":1.11,"words":333},"filePathRelative":"plugins/sonic.md","localizedDate":"May 17, 2021","autoDesc":true,"excerpt":""}')},7621:(s,n,e)=>{e.r(n),e.d(n,{default:()=>t});var a=e(6252);const l=(0,a._)("h1",{id:"sonic",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#sonic"},[(0,a._)("span",null,"Sonic")])],-1),i=(0,a._)("h2",{id:"安装",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#安装"},[(0,a._)("span",null,"安装")])],-1),d={id:"安装-sonic-server",tabindex:"-1"},p={class:"header-anchor",href:"#安装-sonic-server"},o={href:"https://github.com/valeriansaliou/sonic",target:"_blank",rel:"noopener noreferrer"},c=(0,a.uE)('<p>使用 root 用户执行如下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#88C0D0;">nix-env</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">-iA</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">nixpkgs.sonic-server</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装-sonic-插件" tabindex="-1"><a class="header-anchor" href="#安装-sonic-插件"><span>安装 sonic 插件</span></a></h3><p>使用 root 用户执行如下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#88C0D0;">yarn</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">global</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">@hydrooj/sonic</span></span>\n<span class="line"><span style="color:#88C0D0;">hydrooj</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">addon</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#A3BE8C;">@hydrooj/sonic</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动" tabindex="-1"><a class="header-anchor" href="#启动"><span>启动</span></a></h2><p>在 <code>/root/.sonic/config.cfg</code>（没有的自行建立，也可以换成其他的你喜欢的路径）按照以下配置示例写入配置。</p><p>配置示例：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#d8dee9ff;"># Sonic</span></span>\n<span class="line"><span style="color:#d8dee9ff;"># Fast, lightweight and schema-less search backend</span></span>\n<span class="line"><span style="color:#d8dee9ff;"># Configuration file</span></span>\n<span class="line"><span style="color:#d8dee9ff;"># Example: https://github.com/valeriansaliou/sonic/blob/master/config.cfg</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[server]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">log_level = &quot;error&quot;</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[channel]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">inet = &quot;127.0.0.1:1491&quot; # 默认监听本机</span></span>\n<span class="line"><span style="color:#d8dee9ff;">tcp_timeout = 300</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">auth_password = &quot;SecretPassword&quot;</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[channel.search]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">query_limit_default = 10</span></span>\n<span class="line"><span style="color:#d8dee9ff;">query_limit_maximum = 100</span></span>\n<span class="line"><span style="color:#d8dee9ff;">query_alternates_try = 4</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">suggest_limit_default = 5</span></span>\n<span class="line"><span style="color:#d8dee9ff;">suggest_limit_maximum = 20</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.kv]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">path = &quot;/data/sonic/store/kv/&quot;</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">retain_word_objects = 1000</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.kv.pool]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">inactive_after = 1800</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.kv.database]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">flush_after = 900</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">compress = true</span></span>\n<span class="line"><span style="color:#d8dee9ff;">parallelism = 2</span></span>\n<span class="line"><span style="color:#d8dee9ff;">max_files = 100</span></span>\n<span class="line"><span style="color:#d8dee9ff;">max_compactions = 1</span></span>\n<span class="line"><span style="color:#d8dee9ff;">max_flushes = 1</span></span>\n<span class="line"><span style="color:#d8dee9ff;">write_buffer = 16384</span></span>\n<span class="line"><span style="color:#d8dee9ff;">write_ahead_log = true</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.fst]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">path = &quot;/data/sonic/store/fst/&quot;</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.fst.pool]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">inactive_after = 300</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">[store.fst.graph]</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">consolidate_after = 180</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span>\n<span class="line"><span style="color:#d8dee9ff;">max_size = 2048</span></span>\n<span class="line"><span style="color:#d8dee9ff;">max_words = 250000</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行如下命令：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#d8dee9ff;">pm2 start sonic -- -c /root/.sonic/config.cfg</span></span>\n<span class="line"><span style="color:#d8dee9ff;">pm2 save</span></span>\n<span class="line"><span style="color:#d8dee9ff;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><h3 id="后端地址配置" tabindex="-1"><a class="header-anchor" href="#后端地址配置"><span>后端地址配置</span></a></h3><p>进入 HydroOJ 控制面板，配置 sonic 后端地址。</p><p>如果您直接复制配置示例，那么按照以下内容配置：</p><ul><li>host: <code>127.0.0.1</code></li><li>port: <code>1491</code></li><li>auth: <code>SecretPassword</code></li></ul><p>修改完成后，重启 HydroOJ。</p><h3 id="重启-hydrooj" tabindex="-1"><a class="header-anchor" href="#重启-hydrooj"><span>重启 HydroOJ</span></a></h3><p>执行命令 <code>pm2 restart hydrooj</code>。</p><h3 id="重建题目索引" tabindex="-1"><a class="header-anchor" href="#重建题目索引"><span>重建题目索引</span></a></h3><p>进入 HydroOJ 控制面板，在脚本管理中找到重建题目索引，点击运行，参数留空即可。</p><p>至此，搜索功能应当可以正常使用。</p><h2 id="faq" tabindex="-1"><a class="header-anchor" href="#faq"><span>FAQ</span></a></h2><h3 id="安装后题目搜索不正常" tabindex="-1"><a class="header-anchor" href="#安装后题目搜索不正常"><span>安装后题目搜索不正常</span></a></h3><p>请更新到 HydroOJ 最新版本后，再运行重建题目索引。</p>',25),r={},t=(0,e(3744).Z)(r,[["render",function(s,n){const e=(0,a.up)("ExternalLinkIcon");return(0,a.wg)(),(0,a.iD)("div",null,[l,i,(0,a._)("h3",d,[(0,a._)("a",p,[(0,a._)("span",null,[(0,a.Uk)("安装 "),(0,a._)("a",o,[(0,a.Uk)("sonic-server"),(0,a.Wm)(e)])])])]),c])}]])},3744:(s,n)=>{n.Z=(s,n)=>{const e=s.__vccOpts||s;for(const[s,a]of n)e[s]=a;return e}}}]);