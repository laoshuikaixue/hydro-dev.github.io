"use strict";(self.webpackChunkhydro_dev_github_io=self.webpackChunkhydro_dev_github_io||[]).push([[8408],{3694:(s,n,a)=>{a.r(n),a.d(n,{data:()=>l});const l=JSON.parse('{"key":"v-19b5347a","path":"/dev/hook.html","title":"使用 TypeScript 编写插件","lang":"en-US","frontmatter":{"description":"请注意：在阅读本节之前，请确认您已阅读【使用 TypeScript 编写插件】一节并已完成了插件的创建。 示例","head":[["meta",{"property":"og:url","content":"https://hydro.js.org/dev/hook.html"}],["meta",{"property":"og:site_name","content":"Hydro"}],["meta",{"property":"og:title","content":"使用 TypeScript 编写插件"}],["meta",{"property":"og:description","content":"请注意：在阅读本节之前，请确认您已阅读【使用 TypeScript 编写插件】一节并已完成了插件的创建。 示例"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-04-03T09:19:20.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-03T09:19:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"使用 TypeScript 编写插件\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-03T09:19:20.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"示例","slug":"示例","link":"#示例","children":[]}],"git":{"createdTime":1684507766000,"updatedTime":1712135960000,"contributors":[{"name":"undefined","email":"i@undefined.moe","commits":2},{"name":"Milmon","email":"115549630@qq.com","commits":1},{"name":"panda","email":"panda_dtdyy@outlook.com","commits":1}]},"readingTime":{"minutes":0.75,"words":224},"filePathRelative":"dev/hook.md","localizedDate":"May 19, 2023","autoDesc":true,"excerpt":""}')},8371:(s,n,a)=>{a.r(n),a.d(n,{default:()=>e});var l=a(6252);const p=[(0,l.uE)('<h1 id="使用-typescript-编写插件" tabindex="-1"><a class="header-anchor" href="#使用-typescript-编写插件"><span>使用 TypeScript 编写插件</span></a></h1><p>请注意：在阅读本节之前，请确认您已阅读【使用 TypeScript 编写插件】一节并已完成了插件的创建。</p><h2 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h2><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">Time</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">hydrooj</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">async</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">apply</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#81A1C1;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#ECEFF4;">    </span><span style="color:#616E88;">// handler 表示路由事件</span></span>\n<span class="line"><span style="color:#ECEFF4;">    </span><span style="color:#616E88;">// after 表示在主逻辑完成后运行，同时支持 before, before-operation, 参照 【插件编写】 章节 【请求流程】</span></span>\n<span class="line"><span style="color:#ECEFF4;">    </span><span style="color:#616E88;">// RecordDetail 为需要捕获的路由名</span></span>\n<span class="line"><span style="color:#ECEFF4;">    </span><span style="color:#616E88;">// #get 表示仅捕获 GET 请求，若无此后缀表示捕获该路由的所有请求</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">handler/after/RecordDetail#get</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">h</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;">// handler 系列钩子的一参数为对应的 Handler 实例</span></span>\n<span class="line"><span style="color:#ECEFF4;">        </span><span style="color:#616E88;">// 不允许查看 24 小时以前的提交记录</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">h</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rdoc</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">_id</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getTimestamp</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">&lt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">Date</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Date</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">Time</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">day</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#D8DEE9;">h</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">rdoc</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;&#39;</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="shiki nord" style="background-color:#2e3440ff;" tabindex="0"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">Context</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">hydrooj</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">getAnnounce</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">domainId</span><span style="color:#81A1C1;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">string</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">limit</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#ECEFF4;">    </span><span style="color:#616E88;">// 获取公告...</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">adocs</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">async</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">apply</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#81A1C1;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">withHandlerClass</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">HomeHandler</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">HomeHandler</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>\n<span class="line"><span style="color:#ECEFF4;">        </span><span style="color:#616E88;">// 修改 HomeHandler 中的一个方法（添加公告）</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#8FBCBB;">HomeHandler</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">prototype</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">getAnnounce</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">getAnnounce</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5)],o={},e=(0,a(3744).Z)(o,[["render",function(s,n){return(0,l.wg)(),(0,l.iD)("div",null,p)}]])},3744:(s,n)=>{n.Z=(s,n)=>{const a=s.__vccOpts||s;for(const[s,l]of n)a[s]=l;return a}}}]);