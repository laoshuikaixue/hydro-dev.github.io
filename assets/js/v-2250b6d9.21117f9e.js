"use strict";(self.webpackChunkhydro_dev_github_io=self.webpackChunkhydro_dev_github_io||[]).push([[6331],{6910:(e,t,o)=>{o.r(t),o.d(t,{data:()=>n});const n=JSON.parse('{"key":"v-2250b6d9","path":"/docs/system/database.html","title":"数据库备份和恢复","lang":"en-US","frontmatter":{"description":"进入数据库 非常不推荐直接操作数据库！ 1. 当你改动一个字段的时候，可能与其相关的部分忘记修改，改完觉得好像没什么问题，过段时间发现了一些异常，根本不会想到是你这次改数据库导致的，之后又不会修。 2. 直接修改数据库后，可能没有通知主程序，缓存仍然存在，表现为修改不生效。 3. 直接操作数据库的权限过大，若操作失误带来的影响通常是灾难性的。 在绝大部...","head":[["meta",{"property":"og:url","content":"https://hydro.js.org/docs/system/database.html"}],["meta",{"property":"og:site_name","content":"Hydro"}],["meta",{"property":"og:title","content":"数据库备份和恢复"}],["meta",{"property":"og:description","content":"进入数据库 非常不推荐直接操作数据库！ 1. 当你改动一个字段的时候，可能与其相关的部分忘记修改，改完觉得好像没什么问题，过段时间发现了一些异常，根本不会想到是你这次改数据库导致的，之后又不会修。 2. 直接修改数据库后，可能没有通知主程序，缓存仍然存在，表现为修改不生效。 3. 直接操作数据库的权限过大，若操作失误带来的影响通常是灾难性的。 在绝大部..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-04-03T09:17:20.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-03T09:17:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据库备份和恢复\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-03T09:17:20.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"进入数据库","slug":"进入数据库","link":"#进入数据库","children":[]},{"level":2,"title":"快速备份与恢复","slug":"快速备份与恢复","link":"#快速备份与恢复","children":[]},{"level":2,"title":"手动备份","slug":"手动备份","link":"#手动备份","children":[]},{"level":2,"title":"手动恢复备份","slug":"手动恢复备份","link":"#手动恢复备份","children":[]}],"git":{"createdTime":1628908242000,"updatedTime":1712135840000,"contributors":[{"name":"undefined","email":"i@undefined.moe","commits":4},{"name":"panda","email":"panda_dtdyy@outlook.com","commits":2},{"name":"Macesuted","email":"macesuted@qq.com","commits":1},{"name":"pt3155420267","email":"33685002+pt3155420267@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":1.79,"words":536},"filePathRelative":"docs/system/database.md","localizedDate":"August 14, 2021","autoDesc":true,"excerpt":""}')},7814:(e,t,o)=>{o.r(t),o.d(t,{default:()=>k});var n=o(6252);const a=(0,n.uE)('<h1 id="数据库备份和恢复" tabindex="-1"><a class="header-anchor" href="#数据库备份和恢复"><span>数据库备份和恢复</span></a></h1><h2 id="进入数据库" tabindex="-1"><a class="header-anchor" href="#进入数据库"><span>进入数据库</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p><strong>非常不推荐直接操作数据库！</strong></p><ol><li>当你改动一个字段的时候，可能与其相关的部分忘记修改，改完觉得好像没什么问题，过段时间发现了一些异常，根本不会想到是你这次改数据库导致的，之后又不会修。</li><li>直接修改数据库后，可能没有通知主程序，缓存仍然存在，表现为修改不生效。</li><li>直接操作数据库的权限过大，若操作失误带来的影响通常是灾难性的。</li></ol></div><p>在绝大部分情况下均不需要/不可以直接操作数据库。若确需要，可使用 <code>hydrooj db</code> 命令打开数据库 shell，也可以从 <code>~/.hydro/config.json</code> 查找数据库 connection string 并使用外部工具进行连接。</p><p>注：MongoDB 的用户是附加在特定数据库中的，使用外部工具连接请确保使用了正确的 <code>authSource</code> 选项。</p><h2 id="快速备份与恢复" tabindex="-1"><a class="header-anchor" href="#快速备份与恢复"><span>快速备份与恢复</span></a></h2><p>为了保证数据安全，请定期备份。</p><p>若您使用自动脚本安装，可使用 <code>hydrooj backup</code> 快捷备份数据，备份完成后会在当前目录生成备份压缩包文件，您可使用 <code>hydrooj restore &lt;备份文件路径&gt;</code> 恢复之前备份的数据。</p><h2 id="手动备份" tabindex="-1"><a class="header-anchor" href="#手动备份"><span>手动备份</span></a></h2>',9),r={href:"https://docs.mongodb.com/database-tools/mongodump/",target:"_blank",rel:"noopener noreferrer"},l=(0,n._)("code",null,"/data/file",-1),d=(0,n._)("p",null,[(0,n.Uk)("对于数据库，请"),(0,n._)("strong",null,"请不要在数据库运行时直接拷贝数据库文件夹"),(0,n.Uk)("。请每次备份后检查生成的备份文件的大小和内容，确保备份成功。"),(0,n._)("br"),(0,n.Uk)(" 请不要把备份数据和 Hydro 系统放在同一台机器上，这样数据丢失的风险仍然较高。")],-1),i=(0,n._)("h2",{id:"手动恢复备份",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#手动恢复备份"},[(0,n._)("span",null,"手动恢复备份")])],-1),s={href:"https://docs.mongodb.com/database-tools/mongorestore/",target:"_blank",rel:"noopener noreferrer"},c=(0,n._)("code",null,"/data/file",-1),p=(0,n._)("br",null,null,-1),h=(0,n._)("strong",null,"停止 Hydro 和 MongoDB 服务后",-1),m=(0,n._)("code",null,"/data/db",-1),u=(0,n._)("code",null,"/data/file",-1),g=(0,n._)("code",null,"/root/.hydro/config.json",-1),_={},k=(0,o(3744).Z)(_,[["render",function(e,t){const o=(0,n.up)("ExternalLinkIcon");return(0,n.wg)(),(0,n.iD)("div",null,[a,(0,n._)("p",null,[(0,n.Uk)("可使用 MongoDB 自带的 "),(0,n._)("a",r,[(0,n.Uk)("mongodump"),(0,n.Wm)(o)]),(0,n.Uk)(" 进行数据库备份。并将 "),l,(0,n.Uk)(" 文件夹备份即可。")]),d,i,(0,n._)("p",null,[(0,n.Uk)("使用 MongoDB 自带的 "),(0,n._)("a",s,[(0,n.Uk)("mongorestore"),(0,n.Wm)(o)]),(0,n.Uk)(" 导入备份的数据库文件，并还原 "),c,(0,n.Uk)(" 目录文件。"),p,(0,n.Uk)(" 如果只是想不同机器之间迁移部署，只需要在"),h,(0,n.Uk)("将相关文件夹（通常为 "),m,(0,n.Uk)(" 与 "),u,(0,n.Uk)(" 与 "),g,(0,n.Uk)(" ）复制即可。")])])}]])},3744:(e,t)=>{t.Z=(e,t)=>{const o=e.__vccOpts||e;for(const[e,n]of t)o[e]=n;return o}}}]);